#!/bin/bash


main () {
	MODE=encode
	while getopts :de Opt; do
		case $Opt in
			d) MODE=decode;;
			e) MODE=encode;;
		esac
		shift;
		OPTIND=1;
	done
	
	case $MODE in
		encode) urlencode $@;;
		decode) urldecode $@;;
	esac

}


urlencode () {
	if [ $# -gt 0 ]; then
		echo -n "$@" | urlencode
	else 
		od -A n -t x1 -w32 | tr -s ' \n' '%\0'  # this produces a non-breaking line of completely-encoded text (even URL-safe chars are encoded)
			fi
}
urldecode () {
	if [ $# -gt 0 ]; then
		echo -n "$@" | urldecode
	else
		/usr/bin/printf "%b" "$(sed -r -e 's/%([0-9a-fA-F]{2})/\\x\1/g')" # convers %NN to the equivalent ASCII
			fi
}


main $@
