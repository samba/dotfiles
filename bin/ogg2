#!/bin/sh

main () {
  local input= format= output= menc_opts=
  while getopts :i:f:o: Opt; do
    case $Opt in
      i) input=$OPTARG;;
      f) format=$OPTARG;;
      o) output=$OPTARG;;
    esac
  done

  case $format in
    AVI)
      menc_opts="-of avi -ovc lavc -oac pcm"
      ;;
    FLV)
      menc_opts="-of lavf -oac mp3lame -lameopts abr:br=56 -srate 22050 -ovc lavc -lavcopts vcodec=flv:vbitrate=1024:mbd=2:mv0:trell:v4mv:cbp:last_pred=3"
      ;;
    X264)
      menc_opts="-of mpeg -ovc x264 -oac mp3lame"
      ;;
  esac

  [ -z "$menc_opts" ] && return 157
  
  mencoder $input -o $output $menc_opts

}

main $@

exit $?


